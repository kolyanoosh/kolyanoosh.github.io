<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>cssanim</title>
 </head>
 <body id="body1">
  <button id="button1" class="btn123" onclick="window.location.href = 'index.html'">Игра</button>
  <button id="button2" class="btn123" onclick="window.location.href = 'market.html'">Скины</button>
  <button id="button3" class="btn123" onclick="window.location.href = 'tasks.html'">Задания</button>
  <img id="imgmain" src="background.png"></div>
  <img id="cat" src="catforanim.png" />
  <img id="coin" class="coin" src="coin.png" />
  <div id="backgr"></div>
  <div id="fishing-rod"></div>
  <div class="line" id="line"></div>
  <h1 id="score" class="centr">0</h1>
  <h2 id="name" style="position:absolute;left:10;top:0;margin-bottom:0">1</h2>
  
  <style>/* The animation code */
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Exo:wght@400;700&display=swap');
    @keyframes example1 {
        0%   {bottom:32.57%;}
        50% {bottom:26.5151515152%;}
        100% {bottom:32.57%;}
    }
    @keyframes animforcoin {
        0% {bottom: 15.15%;
            visibility: hidden;}
        50% {bottom: 15.15%;
            visibility: hidden;}
        100% {bottom: 22.72%;
            visibility: visible;}
    }

    /* The element to apply the animation to */
    .exampleanim{
        animation: example 4s forwards;
    }
    .exampleanim1{
        animation: example1 2s forwards;
    }
    .animforcoin1{
        animation: animforcoin 2s forwards;
    }
    .centr{
        position: fixed;
        top: 24.24%;
        left: 65.79%;

    }
    #imgmain{
        z-index: -2;
    }
    .coin{
       position: fixed;
       left: 39.5%;
       bottom: 15.15%;
       visibility: hidden;
       z-index: 99999999;
    }
    #fishing-rod {
        position: fixed;
        bottom: 26.06%;
        left: 44.73%;
        width: 3px;
        height: 100px;
        background-color: #8b4513;
        transform: rotate(30deg);
        z-index: 2;
    }

    .line {
        position: fixed;
        bottom: 32.57%;
        left: 51.85%;
        transform: translateX(-50%);
        width: 2px;
        top: 60.6%;
        background-color: #000;
    }
    #cat{
        width: 400px;
        position:fixed;
        left:5.8%;
        bottom: 25%;
    }
    #backgr{
        position: fixed;
        bottom: 30px;
        width: 365px;
        height: 60px;
        border-radius: 15px;
        z-index: 0;
        background-color: #5a5858;
    }
    
    #button1 {
            position: fixed;
            bottom: 50px;
            width: 100px;
            left: 10px;
            border-radius: 15px;
            z-index: 1;
            background-color: #333;
            color: aliceblue;
            font-family: 'Exo', sans-serif;
        }
    #button2 {
        position: fixed;
        bottom: 50px;
        width: 100px;
        left: 130px;
        border-radius: 15px;
        z-index: 1;
        background-color: #333;
        color: aliceblue;
        font-family: 'Exo', sans-serif;
    }
    #button3 {
        position: fixed;
        bottom: 50px;
        width: 100px;
        left: 250px;
        border-radius: 15px;
        z-index: 1;
        background-color: #333;
        color: aliceblue;
        font-family: 'Exo', sans-serif;
    }
    #button1:active { background: rgba(255,255,255,.2); }
    #button2:active { background: rgba(255,255,255,.2); }
    #button3:active { background: rgba(255,255,255,.2); }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
        import { getFirestore,getDoc,getDocs, doc, collection, addDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyA3DHLEIODQIz1bVJeJQjBPzt2ws9AjeR0",
          authDomain: "cryptofish-2e064.firebaseapp.com",
          projectId: "cryptofish-2e064",
          storageBucket: "cryptofish-2e064.appspot.com",
          messagingSenderId: "17827617649",
          appId: "1:17827617649:web:033599b13d0de7e95634d0",
          measurementId: "G-47WE3X1NEG"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        console.log(app);

        const db = getFirestore();
        let tg = window.Telegram.WebApp;
        let username = tg.initDataUnsafe.user.username;

        getDoc(doc(db,'Users',username)).then(docSnap =>{
            if(docSnap.exists()){
                console.log(docSnap.data()['money'])
            }
            else{
                setDoc(doc(db, "Users", username), {
                    money: 0
                });
            }

        })
        

        /* Задайте желаемый идентификатор документа
        const documentId = 'neuralproguy';
        setDoc(doc(db, "Users", documentId), {
            money: 100000
        });*/

    
        let line = document.querySelector('.line');
        let btnstop = document.getElementById('paus');
        let h1 = document.getElementById('score');
        let coin = document.querySelector('.coin');
        getDoc(doc(db,'Users',username)).then(docSnap =>{
            if(docSnap.exists()){
                console.log(docSnap.data()['money'])
                h1.innerText = docSnap.data()['money'];
            }

        })
        let h2 = document.getElementById('name');

        console.log(parseInt(h1.innerText)+1)

        function randomInteger(min, max) {
            // случайное число от min до (max+1)
            let rand = min + Math.random() * (max + 1 - min);
            rand = Math.floor(rand);
            console.log(rand);
            return rand;
        }

        let bodyk = document.getElementById('body1');
        document.addEventListener("click", function() {
            line.classList.add('exampleanim1');
            coin.classList.add("animforcoin1")
            randomInteger(1,5);
        });

        // Отслеживаем окончание анимации
        line.addEventListener("animationend", AnimationHandler1, false);
        function AnimationHandler () {
            // Удаляем класс с анимацией
            box.classList.remove('exampleanim');
        }
        function AnimationHandler1 () {
            // Удаляем класс с анимацией
            line.classList.remove('exampleanim1');
            coin.classList.remove('animforcoin1');
            randomint = randomInteger(10,50);
            h1.innerText = parseInt(h1.innerText)+randomint;
            setDoc(doc(db, "Users", username), {
                money: parseInt(h1.innerText)
            });
        }
        h2.innerText = username; 
    </script>
    <script>
        function randomInteger(min, max) {
            // случайное число от min до (max+1)
            let rand = min + Math.random() * (max + 1 - min);
            rand = Math.floor(rand);
            console.log(rand);
            return rand;
        }
        
        let h12 = document.getElementById('score');
        document.addEventListener("click", function() {
            console.log(1);
            randomint = randomInteger(10,50);
            h12.innerText = parseInt(h12.innerText)+randomint;
        });</script>
 </body>
</html>
