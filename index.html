<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>cssanim</title>
 </head>
 <body id="body1">
  <img src="background.png"></div>
  <img id="cat" src="catforanim.png" />
  <img id="coin" class="coin" src="coin.png" />
  <div id="fishing-rod"></div>
  <div class="line" id="line"></div>
  <h1 id="score" class="centr">0</h1>
  <iframe crossorigin="anonymous" src="http://www.youtube.com/embed/" width="400" height="400"></iframe>
  <h2 id="name" style="position:absolute;left:10;top:0;margin-bottom:0">1</h2>
  
  <style>/* The animation code */
    @keyframes example1 {
        0%   {bottom:215px;}
        50% {bottom:175px;}
        100% {bottom:215px;}
    }
    @keyframes animforcoin {
        0% {bottom: 100px;
            visibility: hidden;}
        50% {bottom: 100px;
            visibility: hidden;}
        100% {bottom: 150px;
            visibility: visible;}
    }

    /* The element to apply the animation to */
    .exampleanim{
        animation: example 4s forwards;
    }
    .exampleanim1{
        animation: example1 2s forwards;
    }
    .animforcoin1{
        animation: animforcoin 2s forwards;
    }
    .centr{
        position: absolute;
        top: 160px;
        left: 250px;

    }

    .coin{
       position: absolute;
       left: 150px;
       bottom: 100px;
       visibility: hidden;
       z-index: 99999999;
    }
    #fishing-rod {
        position: absolute;
        bottom: 172px;
        left: 170px;
        width: 3px;
        height: 100px;
        background-color: #8b4513;
        transform: rotate(30deg);
        z-index: 2;
    }

    .line {
        position: absolute;
        bottom: 215px;
        left: 197px;
        transform: translateX(-50%);
        width: 2px;
        top: 400px;
        background-color: #000;
    }
    #cat{
        width: 400px;
        position:absolute;
        left:-60px;
        right:100px;
        bottom: -8px;
    }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
        import { getFirestore,getDoc,getDocs, doc, collection, addDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyA3DHLEIODQIz1bVJeJQjBPzt2ws9AjeR0",
          authDomain: "cryptofish-2e064.firebaseapp.com",
          projectId: "cryptofish-2e064",
          storageBucket: "cryptofish-2e064.appspot.com",
          messagingSenderId: "17827617649",
          appId: "1:17827617649:web:033599b13d0de7e95634d0",
          measurementId: "G-47WE3X1NEG"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        console.log(app);

        const db = getFirestore();
        let tg = window.Telegram.WebApp;
        let username = tg.initDataUnsafe.user.username;

        getDoc(doc(db,'Users',username)).then(docSnap =>{
            if(docSnap.exists()){
                console.log(docSnap.data()['money'])
            }
            else{
                setDoc(doc(db, "Users", username), {
                    money: 0
                });
            }

        })
        

        /* Задайте желаемый идентификатор документа
        const documentId = 'neuralproguy';
        setDoc(doc(db, "Users", documentId), {
            money: 100000
        });*/

    
        let line = document.querySelector('.line');
        let btnstop = document.getElementById('paus');
        let h1 = document.getElementById('score');
        let coin = document.querySelector('.coin');
        getDoc(doc(db,'Users',username)).then(docSnap =>{
            if(docSnap.exists()){
                console.log(docSnap.data()['money'])
                h1.innerText = docSnap.data()['money'];
            }

        })
        let h2 = document.getElementById('name');

        console.log(parseInt(h1.innerText)+1)

        function randomInteger(min, max) {
            // случайное число от min до (max+1)
            let rand = min + Math.random() * (max + 1 - min);
            rand = Math.floor(rand);
            console.log(rand);
            return rand;
        }

        let bodyk = document.getElementById('body1');
        document.addEventListener("click", function() {
            line.classList.add('exampleanim1');
            coin.classList.add("animforcoin1")
            randomInteger(1,5);
        });

        // Отслеживаем окончание анимации
        line.addEventListener("animationend", AnimationHandler1, false);
        function AnimationHandler () {
            // Удаляем класс с анимацией
            box.classList.remove('exampleanim');
        }
        function AnimationHandler1 () {
            // Удаляем класс с анимацией
            line.classList.remove('exampleanim1');
            coin.classList.remove('animforcoin1');
            randomint = randomInteger(10,50);
            h1.innerText = parseInt(h1.innerText)+randomint;
            setDoc(doc(db, "Users", username), {
                money: parseInt(h1.innerText)
            });
        }
        h2.innerText = username; 
    </script>
    <script>
        function randomInteger(min, max) {
            // случайное число от min до (max+1)
            let rand = min + Math.random() * (max + 1 - min);
            rand = Math.floor(rand);
            console.log(rand);
            return rand;
        }
        
        let h12 = document.getElementById('score');
        document.addEventListener("click", function() {
            console.log(1);
            randomint = randomInteger(10,50);
            h12.innerText = parseInt(h12.innerText)+randomint;
        });</script>
 </body>
</html>
